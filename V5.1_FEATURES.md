# Navis.js v5.1 Features

## Overview

v5.1 focuses on developer experience: OpenAPI/Swagger documentation, API versioning, file upload handling, and testing utilities.

## New Features

### 1. OpenAPI/Swagger Documentation

Auto-generate OpenAPI 3.0 specification and Swagger UI.

**Features:**
- Auto-generate OpenAPI 3.0 spec
- Swagger UI integration
- Route documentation
- Schema definitions
- Security schemes

**Usage:**

```javascript
const { swagger } = require('navis.js');

const swaggerMiddleware = swagger({
  title: 'My API',
  version: '1.0.0',
  description: 'API documentation',
  path: '/swagger.json',
  uiPath: '/docs',
  servers: [{ url: 'http://localhost:3000' }],
});

app.use(swaggerMiddleware.middleware);

// Document routes
swaggerMiddleware.generator.addRoute('GET', '/users/:id', {
  summary: 'Get user by ID',
  tags: ['users'],
  parameters: [{
    name: 'id',
    in: 'path',
    required: true,
    schema: { type: 'string' },
  }],
  responses: {
    '200': { description: 'User found' },
    '404': { description: 'User not found' },
  },
});

// Access at:
// GET /swagger.json - OpenAPI spec
// GET /docs - Swagger UI
```

### 2. API Versioning

URL-based and header-based API versioning.

**Features:**
- URL-based versioning (`/v1/users`, `/v2/users`)
- Header-based versioning (`X-API-Version`)
- Version-specific routes
- Default version support

**Usage:**

```javascript
const { createVersionManager, headerVersioning } = require('navis.js');

// URL-based versioning
const versionManager = createVersionManager();

const v1 = versionManager.version('v1');
v1.get('/users/:id', (req, res) => {
  res.body = { version: 'v1', userId: req.params.id };
});

const v2 = versionManager.version('v2');
v2.get('/users/:id', (req, res) => {
  res.body = { version: 'v2', userId: req.params.id, format: 'modern' };
});

// Register routes
for (const version of versionManager.getVersions()) {
  const routes = versionManager.getRoutes(version);
  for (const method in routes) {
    for (const route of routes[method]) {
      app[method.toLowerCase()](route.path, route.handler);
    }
  }
}

// Header-based versioning
app.use(headerVersioning({
  header: 'X-API-Version',
  defaultVersion: 'v1',
}));

app.get('/users/:id', (req, res) => {
  const version = req.apiVersion || 'default';
  res.body = { version, userId: req.params.id };
});
```

### 3. File Upload Handling

Multipart form data and file upload support.

**Features:**
- File size limits
- File type filtering
- Multiple file uploads
- Custom filename generation
- Automatic directory creation

**Usage:**

```javascript
const { upload } = require('navis.js');

app.post('/upload', upload({
  dest: './uploads',
  limits: {
    fileSize: 5 * 1024 * 1024, // 5MB
    files: 10,
  },
  fileFilter: (file) => {
    return file.mimetype.startsWith('image/') || 
           file.mimetype === 'application/pdf';
  },
  preserveExtension: true,
}), (req, res) => {
  res.body = {
    message: 'Files uploaded',
    files: req.files,
    fields: req.body,
  };
});
```

### 4. Testing Utilities

Test helpers for Navis.js applications.

**Features:**
- HTTP request simulation
- Lambda event simulation
- Response assertions
- Async/await support

**Usage:**

```javascript
const { testApp } = require('navis.js');

const app = new NavisApp();
app.get('/users/:id', (req, res) => {
  res.body = { userId: req.params.id };
});

// Create test app
const test = testApp(app);

// Test requests
const response = await test.get('/users/123');
console.log(response.statusCode); // 200
console.log(response.json()); // { userId: '123' }

// Test with options
const response2 = await test.post('/users', {
  name: 'John',
  email: 'john@example.com',
}, {
  headers: { 'Authorization': 'Bearer token' },
});

// Test Lambda
const lambdaResponse = await test.get('/users/123', null, {
  lambda: true,
});
```

## Complete Example

```javascript
const {
  NavisApp,
  swagger,
  createVersionManager,
  headerVersioning,
  upload,
  testApp,
} = require('navis.js');

const app = new NavisApp();

// Swagger documentation
const swaggerMiddleware = swagger({
  title: 'My API',
  version: '1.0.0',
});
app.use(swaggerMiddleware.middleware);

// API versioning
const versionManager = createVersionManager();
const v1 = versionManager.version('v1');
v1.get('/users/:id', handler);

app.use(headerVersioning());

// File upload
app.post('/upload', upload({ dest: './uploads' }), handler);

app.listen(3000);
```

## Examples

See `examples/v5.1-features-demo.js` for complete working examples.

